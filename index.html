<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atelier Wil - Flux Continu</title>
    <style>
        :root { --accent: #d4af37; --dark: #050505; --green: #2ecc71; }
        body { font-family: sans-serif; background: var(--dark); color: white; text-align: center; margin: 0; }
        .container { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .mesure-nom { font-size: 30px; color: var(--accent); }
        .valeur { font-size: 130px; font-weight: bold; margin: 10px 0; color: white; }
        .led { width: 20px; height: 20px; border-radius: 50%; background: #333; margin-bottom: 10px; }
        .led.on { background: var(--green); box-shadow: 0 0 15px var(--green); }
        .log { font-size: 14px; color: #666; height: 20px; }
    </style>
</head>
<body>

<div class="container" id="ui" style="display:none;">
    <div class="led" id="led"></div>
    <div id="label" class="mesure-nom">Prêt</div>
    <div id="display" class="valeur">--</div>
    <div id="log" class="log">Dites un chiffre...</div>
</div>

<div class="container" id="start-screen">
    <h1 style="color:var(--accent);">ATELIER WIL</h1>
    <button style="padding: 20px 40px; background: var(--accent); border: none; border-radius: 50px; font-weight: bold;" onclick="demarrer()">LANCER LE MODE CONTINU</button>
</div>

<script>
    const mesures = ["Poitrine", "Taille", "Hanches", "Bassin", "Long. Devant", "Carrure Devant", "Encolure", "Carrure Dos", "Long. Dos", "Bras", "Poignet"];
    let idx = 0;
    let recognition;
    let derniereValeur = "";

    function demarrer() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('ui').style.display = 'flex';
        
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new Speech();
        
        // --- LA CONFIGURATION "ZÉRO COUPURE" ---
        recognition.lang = 'fr-FR';
        recognition.continuous = true; 
        recognition.interimResults = true; // On veut voir ce qu'il comprend en direct

        recognition.onstart = () => { document.getElementById('led').classList.add('on'); };
        
        recognition.onresult = (event) => {
            let texte = "";
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                texte += event.results[i][0].transcript;
            }

            // On cherche un nombre dans tout ce qui a été dit
            const match = texte.match(/\d+/g);
            if (match) {
                const nombre = match[match.length - 1]; // On prend le dernier chiffre entendu
                
                if (nombre !== derniereValeur) {
                    derniereValeur = nombre;
                    validerMesure(nombre);
                }
            }
            document.getElementById('log').innerText = "Entendu : " + texte;
        };

        // Si le micro s'arrête (bug système), on le relance sans bip
        recognition.onend = () => {
            console.log("Relance forcée...");
            recognition.start();
        };

        recognition.start();
        majAffichage();
    }

    function validerMesure(v) {
        document.getElementById('display').innerText = v;
        document.getElementById('display').style.color = "#2ecc71";

        // Petite voix de confirmation
        const synth = window.speechSynthesis;
        const phrase = new SpeechSynthesisUtterance(v);
        phrase.lang = 'fr-FR';
        synth.speak(phrase);

        setTimeout(() => {
            idx++;
            if (idx < mesures.length) {
                majAffichage();
                document.getElementById('display').innerText = "--";
                document.getElementById('display').style.color = "white";
            } else {
                document.getElementById('label').innerText = "TERMINÉ";
                recognition.stop();
            }
        }, 2000); // 2 secondes pour vous laisser le temps de voir
    }

    function majAffichage() {
        document.getElementById('label').innerText = mesures[idx];
    }
</script>
</body>
</html>
